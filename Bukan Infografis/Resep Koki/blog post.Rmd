---
title: "Untitled"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

rm(list=ls())
setwd("/cloud/project/Bukan Infografis/Resep Koki")

rm(list=ls())
library(rvest)
library(dplyr)
library(tidyr)

# ambil link dari website
ambil_link = function(utama){
  links = read_html(utama) %>% html_nodes('a') %>% html_attr('href')
  dummy = 
    data.frame(id = c(1:length(links)),
               links) %>%
    filter(grepl('/resep/',links,fixed = T))
  url = as.character(dummy$links)
  return(url)
}

# ambil data dari url
scrap = function(url){
  bahan = read_html(url) %>% 
    html_nodes('.ingredient-action+ td') %>% 
    html_text()
  dummy = data.frame(id = c(1:length(bahan)),
                     bahan) %>%
    separate(bahan,into = c('xx','bahan','xxx'),sep = '\\\n')
  bahan = as.character(dummy$bahan)
  data = data.frame(nama = url,
                    bahan) %>%
    mutate(nama = gsub('https://resepkoki.id/resep/','',nama),
           nama = gsub('\\-',' ',nama),
           nama = gsub('\\/',' ',nama)) %>%
    separate(bahan,into = c('bahan','dummy'),sep='\\,') %>%
    select(nama,bahan) %>% 
    mutate(bahan = tolower(bahan)) %>%
    distinct()
  return(data)
}
```


```{r}
# ambil semua link resep
sites = paste('https://resepkoki.id/category/kue-roti/page/',
              c(1:21),
              '/',
              sep = '')

# mulai iterasi ke 1
i = 1
url = ambil_link(sites[i])

# mulai lagi iterasi dari 2 sampai selesai
for(i in 2:21){
  temp = ambil_link(sites[i])
  url = c(url,temp)
}

# jangan sampai ada yang dobel
url = unique(url)


# sekarang ambil data dari masing2 situsnya
i = 1
data = scrap(url[i])

for(i in 2:length(url)){
  temp = scrap(url[i])
  data = rbind(data,temp)
}

# social network graph
library(igraph)
library(ggraph)
news = data.frame(from = data$nama,
                  to = data$bahan)

# beberes air
news = 
news %>% mutate(to = as.character(to),
                to = ifelse(grepl('santan',to),'santan',to),
                to = ifelse(grepl('air',to),'air',to),
                to = ifelse(grepl('terigu',to),'terigu',to),
                to = ifelse(grepl('telur',to),'telur',to),
                to = ifelse(grepl('gula merah',to),'gula merah',to),
                to = ifelse(grepl('margarin',to),'mentega',to),
                to = ifelse(grepl('dark cooking chocolate',to),'dark cooking chocolate',to),
                to = ifelse(grepl('coklat',to),'coklat',to),
                to = ifelse(grepl('gula',to),'gula',to),
                to = ifelse(grepl('pewarna',to),'pewarna makanan',to),
                to = ifelse(grepl('roti',to),'roti',to),
                to = ifelse(grepl('tepung',to),'terigu',to),
                to = ifelse(grepl('mentega',to),'mentega',to),
                to = ifelse(grepl('keju',to),'keju',to),
                to = ifelse(grepl('cheese',to),'keju',to),
                to = ifelse(grepl('kelapa',to),'kelapa',to),
                to = ifelse(grepl('butter',to),'butter',to),
                to = ifelse(grepl('kayu manis',to),'kayu manis',to),
                to = ifelse(grepl('singkong',to),'singkong',to),
                to = ifelse(grepl('pandan',to),'pandan',to),
                to = ifelse(grepl('kacang hijau',to),'kacang hijau',to),
                to = ifelse(grepl('jagung',to),'jagung',to),
                to = ifelse(grepl('pisang',to),'pisang',to),
                to = ifelse(grepl('vanilla',to),'vanilla',to),
                to = ifelse(grepl('ubi',to),'ubi',to),
                to = ifelse(grepl('cabai',to),'cabai',to),
                to = ifelse(grepl('kopi',to),'kopi',to),
                to = ifelse(grepl('coffee',to),'kopi',to)) 

graph_from_data_frame(news) %>%
  ggraph(layout = 'fr') +
  geom_edge_link(color='darkred',alpha=.4) +
  geom_node_point(size=2,color='steelblue') +
  geom_node_text(aes(label=name),size=2) +
  theme_void()
ggsave('resep.png',width = 10, height = 12,dpi=700)
```